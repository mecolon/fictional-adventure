name: SFCC Code Deployment-TEST

on:
  workflow_dispatch: # to allow running this workflow manually 
  # push:  <== excluded "push:", "branches:" and "-main"  to prevent the workflow from running automatically on commit.
  # branches:
  #    - main
jobs:

  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install sfcc-ci
        run: npm install -g sfcc-ci

      - name: Show Variable
        run: echo ${{ vars.RELEASE_BUILD_NUMBER }}
      - name: show decoded B64 encoded secret  
        run: echo "${{ secrets.BASE64_P12 }}" | base64 -d > ${{ vars.CERT_FILENAME }}
        
      - run: cat ${{ vars.CERT_FILENAME }}
# -----------------------
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          persist-credentials: true
          fetch-depth: 0

      - name: Create a file
        run: |
          echo "Hello from GitHub Actions ðŸš€" > example.txt
          mkdir -p logs
          date > logs/run-date.txt

      - name: Commit and push changes
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          git add .
          git commit -m "Add generated files from workflow" || echo "Nothing to commit."
          git push
